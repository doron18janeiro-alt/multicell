generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Customer {
  id            String         @id @default(uuid())
  companyId     String         @default("multicell-oficial") @map("company_id")
  name          String
  phone         String
  document      String?        
  createdAt     DateTime       @default(now()) @map("created_at")
  serviceOrders ServiceOrder[]
  sales         Sale[]

  @@unique([document, companyId])
  @@map("clients")
}

enum OSStatus {
  ABERTO
  EM_REPARO
  EM_ANDAMENTO
  AGUARDANDO_PECA
  PRONTO
  FINALIZADO
  CANCELADO
}

enum SaleStatus {
  COMPLETED
  REFUNDED
}

model Product {
  id          String   @id @default(cuid())
  companyId   String   @default("multicell-oficial") @map("company_id")
  name        String
  description String?
  category    String
  stock       Int      @default(0)
  minStock    Int      @default(5) @map("min_stock")
  minQuantity Int      @default(2) @map("min_quantity")
  costPrice   Float    @default(0) @map("cost_price")
  salePrice   Float    @map("sale_price")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  supplierId  String?  @map("supplier_id")
  supplier    Supplier?  @relation(fields: [supplierId], references: [id])
  sales       SaleItem[]

  @@map("products")
}

model ServiceOrder {
  id             Int      @id @default(autoincrement())
  companyId      String   @default("multicell-oficial") @map("company_id")
  clientName     String   @map("client_name")
  clientPhone    String   @map("client_phone")
  clientCpf      String?  @map("client_cpf")
  deviceBrand    String   @map("device_brand")
  deviceModel    String   @map("device_model")
  deviceColor    String?  @map("device_color")
  serialNumber   String?  @map("serial_number")
  devicePassword String?  @map("device_password")
  problem        String
  observations   String?
  checklist      Json?    
  status         OSStatus @default(ABERTO)
  
  costPrice      Float    @default(0) @map("cost_price")
  servicePrice   Float    @default(0) @map("service_price")
  totalPrice     Float    @default(0) @map("total_price")
  paymentMethod  String?  @map("payment_method")

  customerId     String?  @map("customer_id")
  customer       Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("os")
}

model Supplier {
  id          String    @id @default(uuid())
  companyId   String    @default("multicell-oficial") @map("company_id")
  name        String
  contact     String?
  whatsapp    String?
  catalogUrl  String?   @map("catalog_url")
  products    Product[]
  
  @@map("suppliers")
}

model Sale {
  id            Int        @id @default(autoincrement())
  companyId     String     @default("multicell-oficial") @map("company_id")
  total         Float
  discount      Float?     @default(0)
  feeAmount     Float?     @default(0) @map("fee_amount")
  netAmount     Float?     @map("net_amount")
  paymentMethod String     @map("payment_method")
  cardType      String?    @map("card_type")
  serviceOrderId Int?      @map("service_order_id")
  status        SaleStatus @default(COMPLETED)
  returnReason  String?    @map("return_reason")
  
  customerId    String?    @map("customer_id")
  customer      Customer?  @relation(fields: [customerId], references: [id], onDelete: Cascade)

  createdAt     DateTime   @default(now()) @map("created_at")
  items         SaleItem[]

  @@map("sales")
}

model SaleItem {
  id        Int     @id @default(autoincrement())
  saleId    Int     @map("sale_id")
  sale      Sale    @relation(fields: [saleId], references: [id])
  productId String? @map("product_id")
  product   Product? @relation(fields: [productId], references: [id])
  description String?
  quantity  Int
  unitPrice Float   @map("unit_price")

  @@map("sale_items")
}

model CompanyConfig {
  id        String   @id @default(cuid())
  companyId String   @default("multicell-oficial") @map("company_id")
  name      String   @default("Multicell")
  document  String?  // CNPJ
  phone     String?
  address   String?
  logoUrl   String?  @default("/logo.png") @map("logo_url")
  debitRate Float    @default(1.99) @map("debit_rate")
  creditRate Float   @default(3.99) @map("credit_rate")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@unique([companyId])
  @@map("company_config")
}

model User {
  id        String  @id @default(uuid())
  companyId String  @map("company_id")
  email     String  @unique
  password  String

  @@map("users")
}

model DailyClosing {
  id          String    @id @default(cuid())
  companyId   String    @default("multicell-oficial") @map("company_id")
  date        DateTime
  totalCash   Float     @default(0) @map("total_cash")
  totalPix    Float     @default(0) @map("total_pix")
  totalDebit  Float     @default(0) @map("total_debit")
  totalCredit Float     @default(0) @map("total_credit")
  totalNet    Float     @default(0) @map("total_net")
  status      String    @default("OPEN")
  closedAt    DateTime? @map("closed_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@unique([date, companyId])
  @@map("daily_closing")
}

